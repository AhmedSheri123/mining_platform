{% extends "dashboard_base.html" %}
{% load static %}

{% block sheri %}

<div class="container p-4">
    {% comment %} <div class="alert alert-warning" role="alert">
    Hello {{ request.user.username }} ðŸ‘‹, here is a quick overview of your investment today
    </div> {% endcomment %}


  <div class="bg-white p-3 rounded shadow-sm text-body-secondary mb-3 col-sm-6 col-md-8 mx-auto ">
    <div class="dropdown d-flex align-items-center justify-content-between">
      
      <!-- Clickable element to open dropdown -->
      <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" 
         data-bs-toggle="dropdown" aria-expanded="false">
        {% if user.profile.img_base64 %}
          <img src="{{user.profile.img_base64}}" alt="" width="46" height="46" class="rounded-circle me-2">
        {% else %}
          <img src="{% static 'img/profile_default/default-profile-img-2.png' %}" alt="" width="46" height="46" class="rounded-circle me-2">
        {% endif %}
        <div class="text-start">
          <p class="mb-1 text-dark fw-bold text-wrap">{{ request.user.username }}</p>
          <span class="bg-primary rounded d-inline px-2 py-1 text-white">{{request.user.profile.balance|floatformat:2 }}$</span>
        </div>
      </a>

      <!-- Separate button -->
      <a href="{% url 'Logout' %}" class="bg-body-tertiary btn btn-light px-2 py-1 ms-2">
        <i class="bi bi-door-open-fill"></i>
      </a>

      <!-- Dropdown menu -->
      <ul class="dropdown-menu dropdown-menu-dark shadow">
        <li><a class="dropdown-item" href="{% url 'my_devices' %}">Start mining...</a></li>
        <li><a class="dropdown-item" href="{% url 'EditProfile' %}">Profile</a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="{% url 'Logout' %}">Logout</a></li>
      </ul>
      
{% if user.is_authenticated %}
{% if user.is_superuser %}
    <a class="btn btn-primary me-2 rounded-4 ms-2" href="{% url 'management' %}">
        Admin dashboard
        <i class="fa-solid fa-gauge-high"></i>
    </a>
{% endif %}

{% endif %}
    </div>
  </div>




    <h5 class="mt-4">Overview</h5>
    <div class=" mt-3 row row-cols-4 justify-content-center justify-content-md-between"  >

        <div class="col card rounded-4 bg-primary me-2 p-2 mt-2 text-white" style="width: 10rem;">
            <div class="card-body">
                <h6 class="card-subtitle mb-2">Total devices</h6>
                <h2 class="mt-4">
                    <i class="bi bi-hdd-stack-fill"></i>
                    {{my_devices.count}} devices
                </h2>
                Last update <strong>now</strong>
            </div>
        </div>
        <div class="col card rounded-4 bg-success me-2 p-2 mt-2" style="width: 10rem;">
            <div class="card-body text-white">
                <h6 class="card-subtitle mb-2 ">Daily earnings</h6>
                <h2 class="mt-4 ">
                    <i class="bi bi-cart-check-fill"></i>
                    {{daily_earning|floatformat:2}} $
                </h2>
                Last update <strong>now</strong>
                {% comment %} last order <strong>3 days ago</strong> {% endcomment %}
            </div>
        </div>
        <div class="col card rounded-4 bg-success-subtle me-2 p-2 mt-2" style="width: 10rem;">
            <div class="card-body">
                <h6 class="card-subtitle mb-2 text-body-secondary">Monthly earnings</h6>
                <h2 class="mt-4">
                    <i class="bi bi-stop-fill text-body-secondary"></i>
                    {{monthly_earning|floatformat:2}} $
                </h2>
                Last update <strong>now</strong>
            </div>
        </div>


        <div class="col card rounded-4 bg-dark me-2 p-2 mt-2" style="width: 10rem;">
            <div class="card-body text-white">
                <h6 class="card-subtitle mb-2 ">Device status</h6>
                <h2 class="mt-4">
                    {% comment %} <i class="bi bi-stop-fill"></i> {% endcomment %}
                    Running {{only_runing_devices.count}} âœ… 
                </h2>
                Last update <strong>now</strong>
            </div>
        </div>

        
    </div>
</div>

<!-- Referral section -->
{% if user.is_authenticated %}
<div class="container py-3 text-center">
  <h2 class="mb-4 fs-5">Your referral code</h2>
  <div class="bg-light p-4 rounded shadow-sm">
    <h3 class="text-primary" id="inviteCode">{{ user.profile.invite_code }}</h3>
    {% comment %} <p>Copy the code and share it with your friends to earn rewards when they join.</p> {% endcomment %}
    <button onclick="copyCode()" class="btn btn-outline-primary mt-2">
      <i class="fa-solid fa-copy"></i> Copy code
    </button>
  </div>
</div>
<script>
function copyCode() {
  var code = document.getElementById("inviteCode").innerText;
  navigator.clipboard.writeText(code);
  alert("Code copied successfully!");
}
</script>
{% endif %}
<!-- End referral section -->



<!-- Fixed circular online users indicator -->
<div id="online-indicator" class="position-fixed end-0 m-4" style="bottom: 50px;">
  <div class="rounded-circle bg-success text-white d-flex flex-column align-items-center justify-content-center shadow"
       style="width: 100px; height: 100px;">
    <div id="onlineCount" class="fw-bold fs-4"></div>
    <div class="fs-6" style="font-size: 12px;">User</div>
    <div class="fs-6" style="font-size: 12px;">Online</div>
  </div>
</div>

<!-- Script to update count -->
<script>
  function updateCounter() {
    const min = 280;
    const max = 320;
    const count = Math.floor(Math.random() * (max - min + 1)) + min;
    document.getElementById('onlineCount').textContent = count;
  }

  setInterval(updateCounter, 3000); // Update every 3 seconds
</script>



{% comment %} 
<canvas id="earningsChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('earningsChart').getContext('2d');
const labels = [{% for record in monthly_records %}'{{ record.date }}',{% endfor %}];
const data = [{% for record in monthly_records %}{{ record.earned|floatformat:2 }},{% endfor %}];

new Chart(ctx, {
    type: 'line',
    data: {
        labels: labels,
        datasets: [{
            label: 'Daily earnings',
            data: data,
            borderColor: 'rgba(75, 192, 192, 1)',
            fill: false,
        }]
    },
    options: {
        scales: {
            y: { beginAtZero: true }
        }
    }
});
</script> {% endcomment %}


{% comment %} <div class="container p-4 ">
    <h5>Last Orders</h5>

    <div class="tabel-box">

        <table class="table">
            <thead>
              <tr>
                <th scope="col">#</th>
                <th scope="col">ID</th>
                <th scope="col">Project name</th>
                <th scope="col">Service</th>
                <th scope="col">Service progress</th>
                <th scope="col">Status</th>
                <th scope="col">Subscription</th>
                <th scope="col">Scope</th>
                <th scope="col">Option</th>
              </tr>
            </thead>
            <tbody>
              {% for order in orders|slice:4 %}
              <tr>
                <th scope="row">1</th>
                <td>{{order.orderID}}</td>
                <td>{{order.user_service.project_name}}</td>
                <td>{{order.user_service.service.title}}</td>
                <td><span class="bg-primary px-2 py-1 rounded text-nowrap">{{order.user_service.get_progress_display}}</span></td>
                <td><span class="bg-primary px-2 py-1 rounded">{{order.get_progress_display}}</span></td>
                <td>{{order.title}}</td>
                <td><span class="bg-primary px-2 py-1 rounded">{{order.get_progress_paid_plan_scope_display}}</span></td>
                <td>
                  {% if order.progress == '1' %}
                  <a href="{% url 'ServicePayment' order.orderID %}" class="btn btn-success">Continue</a>
                  {% elif order.progress == '2' %}
                  <a href="{% url 'UpgradeOrRenewServiceSubscription' order.orderID %}" class="btn btn-success">Use</a>
                  {% endif %}
                  <a href="{% url 'DeleteOrder' order.orderID %}" class="btn btn-danger">Delete</a>
                </td>
              </tr>
              {% endfor %}
  
            </tbody>
          </table>
        </div>
</div> {% endcomment %}










<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-toast-plugin/1.3.2/jquery.toast.min.css">


<script>

// Fetch random name from Random User API
async function getRandomName() {
  const response = await fetch("https://randomuser.me/api/");
  const data = await response.json();
  // First name + last name
  return data.results[0].name.first + " " + data.results[0].name.last;
}

// Generate a random number between 200 and 10000
function randomNumGen() {
  return Math.floor(Math.random() * (10000 - 200 + 1)) + 200;
}

// Main function that executes the task
async function runToast() {
  let name = await getRandomName();
  let shortName = name.substring(0, 6); // First 3 letters
  let stars = "*".repeat(name.length - 6); // Remaining name as stars
  let maskedName = shortName + stars;

  let amount = randomNumGen();

  $.toast({
    heading: maskedName,
    text: `${maskedName} has withdrawn ${amount} USD now`,
    showHideTransition: 'slide',
    icon: 'info',
    position: 'top-right',
    allowToastClose: false,
    hideAfter: 5000 // Closes after 5 seconds
  });

}

// Run every 20 seconds
setInterval(runToast, 20000);
</script>



<style>


/* Slide in from right */
@keyframes slideInRight {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}

/* Slide out to right */
@keyframes slideOutRight {
  from { transform: translateX(0); opacity: 1; }
  to { transform: translateX(100%); opacity: 0; }
}

/* Apply animation to toast */
.jq-toast-single {
  animation: slideInRight 0.3s ease forwards;
}
.jq-toast-single.jq-toast-hidden {
  animation: slideOutRight 0.3s ease forwards;
}
.jq-toast-wrap.top-right {
  top: 110px !important;
}
</style>

{% endblock sheri %}