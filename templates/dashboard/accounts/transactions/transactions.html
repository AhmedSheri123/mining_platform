{% extends "dashboard_base.html" %}

{% block sheri %}

<div class="container p-4">

    {% comment %} <!-- ØªØ­ÙŠØ© Ø³Ø±ÙŠØ¹Ø© -->
    <div class="alert alert-warning" role="alert">
        Ø£Ù‡Ù„Ø§Ù‹ {{ request.user.username }} ğŸ‘‹ØŒ Ù„Ù…Ø­Ø© Ø¹Ù† Ø§Ø³ØªØ«Ù…Ø§Ø±Ø§ØªÙƒ
    </div> {% endcomment %}

    <div class="card mb-4">
        <div class="card-body">
            <h4 class="card-title">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ</h4>
            <p class="card-text display-6">{{ balance|floatformat:2 }} USDT</p>
        </div>
    </div>

    <!-- Ø§Ù„Ø³Ø­Ø¨ Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ (USDT) -->
    <div class="card mb-4">
        <div class="card-header">Ø³Ø­Ø¨ / ØªØ­ÙˆÙŠÙ„ Ø®Ø§Ø±Ø¬ÙŠ (USDT TRC20)</div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="withdraw">
                <div class="mb-3">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
                    <input type="number" step="0.000001" name="amount" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­ÙØ¸Ø©:</label>
                    <input type="text" name="wallet_address" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø·Ù„Ø¨</button>
            </form>
        </div>
    </div>

    {% if request.user.is_superuser %}
    <!-- Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ -->
    <div class="card mb-4">
        <div class="card-header">ØªØ­ÙˆÙŠÙ„ Ø¯Ø§Ø®Ù„ÙŠ</div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="transfer">
                <div class="mb-3">
                    <label>Ø§Ù„Ù…Ø³ØªÙ„Ù… (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…):</label>
                    <input type="text" name="recipient" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº:</label>
                    <input type="number" step="0.000001" name="amount" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">ØªØ­ÙˆÙŠÙ„</button>
            </form>
        </div>
    </div>
{% endif %}
    <!-- Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª -->
    <div class="card">
        <div class="card-header">Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</div>
        <div class="card-body table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th>
                        <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                        <th>Ø§Ù„Ù…Ø³ØªÙ„Ù… / Ø§Ù„Ù…Ø­ÙØ¸Ø©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tx in transactions %}
                    <tr>
                        <td>{{ tx.created_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ tx.get_transaction_type_display }}</td>
                        <td>{{ tx.amount|floatformat:6 }}</td>
                        <td>
                            {% if tx.transaction_type == 'transfer' and tx.to_user %}
                                {{ tx.to_user.username }}
                            {% elif tx.transaction_type == 'withdraw' and tx.wallet_address %}
                                {{ tx.wallet_address }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if tx.transaction_type == 'withdraw' %}
                                {{ tx.get_status_display }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

{% endblock sheri %}
