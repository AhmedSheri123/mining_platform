{% extends "dashboard_base.html" %}

{% block sheri %}

<div class="container p-4">

    {% comment %} <!-- Quick greeting -->
    <div class="alert alert-warning" role="alert">
        Hello {{ request.user.username }} ðŸ‘‹, an overview of your investments
    </div> {% endcomment %}

    <div class="card mb-4">
        <div class="card-body">
            <h4 class="card-title">Your current balance</h4>
            <p class="card-text display-6">{{ balance|floatformat:2 }} USDT</p>
        </div>
    </div>

    <!-- External withdrawal (USDT) -->
    <div class="card mb-4">
        <div class="card-header">Withdraw / external transfer (USDT TRC20)</div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="withdraw">
                <div class="mb-3">
                    <label>Amount:</label>
                    <input type="number" step="0.000001" name="amount" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Wallet address:</label>
                    <input type="text" name="wallet_address" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-primary">Submit request</button>
            </form>
        </div>
    </div>

    {% if request.user.is_superuser %}
    <!-- Internal transfer -->
    <div class="card mb-4">
        <div class="card-header">Internal transfer</div>
        <div class="card-body">
            <form method="post">
                {% csrf_token %}
                <input type="hidden" name="action" value="transfer">
                <div class="mb-3">
                    <label>Recipient (username):</label>
                    <input type="text" name="recipient" class="form-control" required>
                </div>
                <div class="mb-3">
                    <label>Amount:</label>
                    <input type="number" step="0.000001" name="amount" class="form-control" required>
                </div>
                <button type="submit" class="btn btn-success">Transfer</button>
            </form>
        </div>
    </div>
{% endif %}
    <!-- Transaction history -->
    <div class="card">
        <div class="card-header">Transaction history</div>
        <div class="card-body table-responsive">
            <table class="table table-bordered table-striped">
                <thead class="table-light">
                    <tr>
                        <th>Date</th>
                        <th>Transaction type</th>
                        <th>Amount</th>
                        <th>Recipient / wallet</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tx in transactions %}
                    <tr>
                        <td>{{ tx.created_at|date:"Y-m-d H:i" }}</td>
                        <td>{{ tx.get_transaction_type_display }}</td>
                        <td>{{ tx.amount|floatformat:6 }}</td>
                        <td>
                            {% if tx.transaction_type == 'transfer' and tx.to_user %}
                                {{ tx.to_user.username }}
                            {% elif tx.transaction_type == 'withdraw' and tx.wallet_address %}
                                {{ tx.wallet_address }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                        <td>
                            {% if tx.transaction_type == 'withdraw' %}
                                {{ tx.get_status_display }}
                            {% else %}
                                -
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center">No transactions yet</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

{% endblock sheri %}
