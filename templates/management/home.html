{% extends "management_base.html" %}

{% block sheri %}
<div class="container p-4">
    <div class="alert alert-primary">
        ğŸ‘‹ Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù† ÙŠØ§ {{ request.user.username }}
    </div>


    <h4 class="mt-5 mb-3">ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…</h4>
    <div class="row row-cols-2 row-cols-md-4 g-3 mb-3">
        <div class="col">
            <div class="card rounded-4 text-white bg-primary p-3">
                <h6>Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¬Ø¯Ø¯</h6>
                <h2>{{ new_users_today }}</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„ÙŠÙˆÙ…</h6>
                <h2>{{ earnings_today|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø§Ù„Ø£ÙŠØ¯Ø§Ø¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h6>
                <h2>{{ deposit_earnings_today|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h6>
                <h2>{{ transaction_earnings_today|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-dark p-3">
                <h6>Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ© Ø§Ù„ÙŠÙˆÙ…</h6>
                <h2>{{ buyed_devices_today }}</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 bg-warning p-3">
                <h6>Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h6>
                <h2>{{ transactions_today }}</h2>
            </div>
        </div>
    </div>


    <h4 class="mb-3">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¹Ø§Ù…Ø©</h4>
    <div class="row row-cols-2 row-cols-md-4 g-3 mb-3">
        <div class="col">
            <div class="card rounded-4 text-white bg-primary p-3">
                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h6>
                <h2>{{ total_users }}</h2>
            </div>
        </div>

        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h6>
                <h2>{{ total_earnings|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ÙŠØ¯Ø§Ø¹Ø§Øª </h6>
                <h2>{{ total_deposit_earnings|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-success p-3">
                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­ÙˆØ¨Ø§Øª </h6>
                <h2>{{ total_transaction_earnings|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 text-white bg-dark p-3">
                <h6>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±ØµØ¯Ø©</h6>
                <h2>{{ total_balance|floatformat:2 }} $</h2>
            </div>
        </div>
        <div class="col">
            <div class="card rounded-4 bg-warning p-3">
                <h6>Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù†Ø´Ø·Ø©</h6>
                <h2>{{ active_devices }}/{{ total_devices }}</h2>
            </div>
        </div>
    </div>

    <hr class="my-4">

    <div class="row">
        <div class="col-md-6 mb-3">
            <h5>Ø¢Ø®Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h5>
            <ul class="list-group">
                {% for user in latest_users %}
                    <li class="list-group-item d-flex justify-content-between">
                        {{ user.user.username }} 
                        <span class="text-muted">{{ user.balance|floatformat:2 }} $</span>
                    </li>
                {% empty %}
                    <li class="list-group-item">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¹Ø¯</li>
                {% endfor %}
            </ul>
        </div>


        <div class="col-md-6 mb-3">
            <h5>Ø¢Ø®Ø± Ø§Ù„Ø£ÙŠØ¯Ø§Ø¹Ø§Øª</h5>
            <ul class="list-group">
                {% for user in latest_deposits %}
                    <li class="list-group-item d-flex justify-content-between">
                        {{ user.wallet.user.username }} 
                        <span class="text-muted">{{ user.amount|floatformat:2 }} $</span>
                    </li>
                {% empty %}
                    <li class="list-group-item">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø§ÙŠØ¯Ø§Ø¹Ø§Øª Ø¨Ø¹Ø¯</li>
                {% endfor %}
            </ul>
        </div>

        <div class="col-md-6 mb-3">
            <h5>Ø¢Ø®Ø± Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª</h5>
            <ul class="list-group">
                {% for tx in latest_transactions %}
                    <li class="list-group-item d-flex justify-content-between">
                        {{ tx.user.username }} 
                        <span class="text-success">{{ tx.amount|floatformat:2 }} $</span>
                    </li>
                {% empty %}
                    <li class="list-group-item">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø¨Ø¹Ø¯</li>
                {% endfor %}
            </ul>
        </div>
    </div>


    <div class="container p-4">
        <h5>Ù…Ø¤Ø´Ø± Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØ§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª Ù„Ø¢Ø®Ø± 30 Ø£ÙŠØ§Ù…</h5>
        <canvas id="threeDaysChart" style="height:300px;"></canvas>
    </div>

    <div class="container py-4">
        <h5>Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹</h5>
        <canvas id="balancesChart" style="height:300px;"></canvas>
    </div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ctx = document.getElementById('balancesChart').getContext('2d');
const balancesChart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: {{ difference_chart_labels|safe }},
        datasets: [{
            label: 'Ø§Ù„Ø¯ÙˆÙ„Ø§Ø± $',
            data: {{ difference_chart_data|safe }},
            backgroundColor: [
                'rgba(54, 162, 235, 0.7)',  // Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ
                'rgba(75, 192, 192, 0.7)',  // Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª
                'rgba(255, 206, 86, 0.7)'   // Ø§Ù„ÙØ§Ø±Ù‚
            ],
            borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(255, 206, 86, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: { display: false },
            title: {
                display: true,
                text: 'Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„ÙƒÙ„ÙŠ Ù…Ù‚Ø§Ø¨Ù„ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª ÙˆØ§Ù„ÙØ§Ø±Ù‚'
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});




const ctxThreeDays = document.getElementById('threeDaysChart').getContext('2d');

new Chart(ctxThreeDays, {
    type: 'line', // Ù…Ø®Ø·Ø· Ø®Ø·ÙŠ
    data: {
        labels: {{ chart_labels|safe }},
        datasets: [
            {
                label: 'Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†',
                data: {{ balance_data|safe }},
                borderColor: 'rgba(255, 99, 132, 1)', // Ø£Ø­Ù…Ø±
                backgroundColor: 'rgba(255, 99, 132, 0.2)',
                borderWidth: 2,
                tension: 0.3, // Ù„ØªÙ†Ø¹ÙŠÙ… Ø§Ù„Ø®Ø·
                fill: false
            },
            {
                label: 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹Ø§Øª',
                data: {{ deposits_data|safe }},
                borderColor: 'rgba(75, 192, 75, 1)', // Ø£Ø®Ø¶Ø±
                backgroundColor: 'rgba(75, 192, 75, 0.2)',
                borderWidth: 2,
                tension: 0.3,
                fill: false
            }
        ]
    },
    options: {
        responsive: true,
        interaction: {
            mode: 'index',
            intersect: false,
        },
        plugins: {
            legend: {
                display: true,
                labels: {
                    font: { size: 14 }
                }
            },
            tooltip: {
                enabled: true,
                mode: 'nearest',
                intersect: false
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});

</script>

</div>
{% endblock sheri %}
